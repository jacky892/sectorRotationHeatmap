# sectorRotationHeatmap

Update: added support to dukascopy datasource which can be download tick data if needed. Install dukascopy-node to use this function.


install node on windows:
1. '$ choco install -y nodejs-lts --force'

1. '$ npm install dukascopy-node --save'

to run all the test cases:
1. '$ cd tests'

1. '$ pytest -s --log-cli-level=INFO'

to get updated data:

1. '$ python update_data.py'

to run the model:

1. '$ python run_model.py'

Visit https://www.linkedin.com/pulse/identifying-sector-rotation-trading-signals-using-heatmap-jacky-lee on detailed description on the model.

### Running as a chat service	

You can also run this program in chat bot mode as follow:

1, Ask @botfather to create a new bot and get the token.  You will then be able to talk to your bot in telegram using @your_bot_name.  The command to request equity prediction using sector rotation data is "se <ticker>". E.g. "se AAPL" will return the prediction for AAPL.  

2, You will need to have RabbitMQ installed and running as a service first, check out (Rabbitmq)[https://www.rabbitmq.com/download.html]for more details.  You can also use docker to run RabbitMQ as a service.  Once you have RabbitMQ running, you can start and configure the service using the web interface at http://localhost:15672/ 

3, Add a user tgbot/tgbot using the web interface, this username and password need to be set in the simpleMQUser.py

4, Once the Rabbitmq User is added, you can start the service by running the following command:

    $ python tgChatDaemon.py

When you run the the daemon for the first time, the system will ask you for the tg api token, just copy and paste to the prompt and it will be saved in config.ini.

5, run the sectorRotation worker:
  'python rqSectorRotJobWorker.py'


6, You can run multiple copies of this job to handle the command receive by the worker.  The worker will post the result to the tgDictReply queue.  The chat daemon will poll this queue and send the result to the end user.

Communication between chat daemon and worker is done via a base64 encoded python dictionary object which include the userid and the chat and table image generated by the worker. User command messages are  dispatched to sectorRotationBot which is consumed by the worker.  
    

    
7 , To check the queue status
    
1. 'rabbitmqctl list_queues' 
sample output:
Listing queues for vhost / ...
name	messages
tgDictReply	0
sectorRotationBot	0
    
The worker in turn produce reply as a base64 pickle object and post it to tgDictReply queue.  The chat daemon which maintain the session with Telegram user, polls this queue and send the reply to the end user.